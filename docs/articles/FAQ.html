<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frequently asked questions • variancePartition</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Frequently asked questions">
<meta property="og:description" content="variancePartition">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">variancePartition</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.25.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/FAQ.html">Frequently asked questions</a>
    </li>
    <li>
      <a href="../articles/additional_visualization.html">Additional visualizations of variance structure</a>
    </li>
    <li>
      <a href="../articles/dream.html">dream: Differential expression testing with linear mixed models for repeated measures</a>
    </li>
    <li>
      <a href="../articles/theory_practice_random_effects.html">Theory and practice of random effects and REML</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GabrielHoffman/variancePartition/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="FAQ_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Frequently asked questions</h1>
                        <h4 class="author"><a href="http://gabrielhoffman.github.io">Gabriel Hoffman</a></h4>
            <address class="author_afil">
      <p>Icahn School of Medicine at Mount Sinai, New York</p>
<br><small class="dont-index">Source: <a href="https://github.com/GabrielHoffman/variancePartition/blob/master/vignettes/FAQ.Rmd"><code>vignettes/FAQ.Rmd</code></a></small>
      <div class="hidden name"><code>FAQ.Rmd</code></div>

    </address>
</div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>Errors and warnings in <code>variancePartition</code> are mostly designed to let the user know that there is an isssue with the model. Note that some of these warnings and errors can be overridden by specifying <code>suppressWarnings=TRUE</code> for <code><a href="../reference/dream.html">dream()</a></code> and <code>showWarnings=FALSE</code> for <code><a href="../reference/fitExtractVarPartModel.html">fitExtractVarPartModel()</a></code> and <code><a href="../reference/fitVarPartModel.html">fitVarPartModel()</a></code>. Here is a guide to interperting interpreting warnings and errors from <code>variancePartition</code> and <code>dream</code>. Note that some of the document can be found in “1) Tutorial on using variancePartition”.</p>
    </div>
    
<!---
cd /Users/gabrielhoffman/workspace/repos
R
library('knitr')
rmarkdown::render('variancePartition/vignettes/FAQ.Rmd')


rmarkdown::render('FAQ.Rmd')

--->
<div id="current-github-issues" class="section level1">
<h1 class="hasAnchor">
<a href="#current-github-issues" class="anchor"></a>Current GitHub issues</h1>
<p>See <a href="https://github.com/GabrielHoffman/variancePartition/issues">GitHub page</a> for up-to-date responses to users’ questions.</p>
</div>
<div id="warnings" class="section level1">
<h1 class="hasAnchor">
<a href="#warnings" class="anchor"></a>Warnings</h1>
<ul>
<li>
<p><code>No Intercept term was specified in the formula:  The results will not behave as expected and may be very wrong!!</code></p>
<p>An intercept (i.e. mean term) must be specified order for the results to be statistically valid. Otherwise, the variance percentages will be <em>very</em> overestimated.</p>
</li>
<li>
<p><code>Categorical variables modeled as fixed effect: The results will not behave as expected and may be very wrong!!</code></p>
<p>If a linear mixed model is used, all categorical variables must be modeled as a random effect. Alternatively, a fixed effect model can be used by modeling all variables as fixed.</p>
</li>
<li>
<p><code>Cannot have more than one varying coefficient term:\newline The results will not behave as expected and may be very wrong!!</code></p>
<p>Only one varying coefficient term can be specified. For example, the formula <code>~(Tissue+0|Individual) + (Batch+0|Individual)</code> contains two varying coefficient terms and the results from this analysis are not easily interpretable. Only a formula with one term like <code>(Tissue+0|Individual)</code> is allowed.</p>
</li>
</ul>
</div>
<div id="errors" class="section level1">
<h1 class="hasAnchor">
<a href="#errors" class="anchor"></a>Errors</h1>
<ul>
<li><p><code>Colinear score &gt; .99: Covariates in the formula are so strongly correlated that the parameter estimates from this model are not meaningful.  Dropping one or more of the covariates will fix this problem</code></p></li>
<li><p><code>Error in asMethod(object) : not a positive definite matrix</code></p></li>
<li><p><code>In vcov.merMod(fit) : Computed variance-covariance matrix problem: not a positive definite matrix; returning NA matrix</code></p></li>
<li>
<p><code>fixed-effect model matrix is rank deficient so dropping 26 columns / coefficients</code></p>
<p>Including variables that are highly correlated can produce misleading results (see Section “Detecting problems caused by collinearity of variables”). In this case, parameter estimates from this model are not meaningful. Dropping one or more of the covariates will fix this problem.</p>
</li>
<li>
<p><code>Error in checkNlevels(reTrms$flist, n = n, control): number of levels of each grouping factor must be &lt; number of observations</code></p>
<p>This arises when using a varying coefficient model that examines the effect of one variable inside subsets of the data defined by another: <code>~(A+0|B)</code>. See Section “Variation within multiple subsets of the data”. There must be enough observations of each level of the variable B with each level of variable A. Consider an example with samples from multiple tissues from a set of individual where we are interested in the variation across individuals within each tissue using the formula: <code>~(Tissue+0|Individual)</code>. This analysis will only work if there are multiple samples from the same individual in at least one tissue. If all tissues only have one sample per individual, the analysis will fail and <code>variancePartition</code> will give this error.</p>
</li>
<li>
<p><code>Problem with varying coefficient model in formula: should have form (A+0|B)</code></p>
<p>When analyzing the variation of one variable inside another (see Section “Variation within multiple subsets of the data”.), the formula most be specified as <code>(Tissue+0|Individual)</code>. This error occurs when the formula contains <code>(Tissue|Individual)</code> instead.</p>
</li>
<li><p><code>fatal error in wrapper code</code></p></li>
<li><p><code>Error in mcfork() : unable to fork, possible reason: Cannot allocate memory</code></p></li>
<li>
<p><code>Error: cannot allocate buffer</code></p>
<p>This error occurs when <code>fitVarPartModel</code> uses too many threads and takes up too much memory. The easiest solution is to use <code>fitExtractVarPartModel</code> instead. Occasionally there is an issue in the parallel backend that is out of my control. Using fewer threads or restarting R will solve the problem.</p>
</li>
</ul>
<div id="errors-problems-removing-samples-with-nananinf-values" class="section level2">
<h2 class="hasAnchor">
<a href="#errors-problems-removing-samples-with-nananinf-values" class="anchor"></a>Errors: Problems removing samples with NA/NaN/Inf values</h2>
<p><code>variancePartition</code> fits a regression model for each gene and drops samples that have NA/NaN/Inf values in each model fit. This is generally seamless but can cause an issue when a variable specified in the formula no longer varies within the subset of samples that are retained. Consider an example with variables for sex and age where age is NA for all males samples. Dropping samples with invalid values for variables included in the formula will retain only female samples. This will cause <code>variancePartition</code> to throw an error because there is now no variation in sex in the retained subset of the data. This can be resolved by removing either age or sex from the formula.</p>
<p>This situtation is indicated by the following errors:</p>
<ul>
<li><p><code>Error: grouping factors must have &gt; 1 sampled level</code></p></li>
<li><p><code>Error: Invalid grouping factor specification, Individual</code></p></li>
<li><p><code>Error in contrasts&lt;-(*tmp*, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</code></p></li>
<li><p><code>Error in checkNlevels(reTrms\$flist, n = n, control): grouping factors must have &gt; 1 sampled level</code></p></li>
</ul>
</div>
<div id="errors-with-biocparallel-multithreading-backend" class="section level2">
<h2 class="hasAnchor">
<a href="#errors-with-biocparallel-multithreading-backend" class="anchor"></a>Errors with BiocParallel multithreading backend</h2>
<ul>
<li><p><code>Error: 'bpiterate' receive data failed: error reading from connection</code></p></li>
<li>
<p><code>Error in serialize(data, node$con, xdr = FALSE) : ignoring SIGPIPE signal</code></p>
<p><code>variancePartition</code> uses the <code>BiocParallel</code> package to run analysis in parallel across multiple cores. If there is an issue with the parallel backend you might see these errors. This often occurs in long interactive sessions, or if you manually kill a function running in parallel. There are two ways to address this issue.</p>
<ul>
<li>
<p><strong>Global</strong>: set the number of threads to be a smaller number. I have found that reducing the number of threads reduces the chance of random failures like this.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocParallel">BiocParallel</a></span><span class="op">)</span>

<span class="co"># globally specify that all multithreading using bpiterate from BiocParallel</span>
<span class="co"># should use 8 cores</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html">SnowParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</li>
<li>
<p><strong>Local</strong>: set the number of theads at each function call. This re-initializes the parallel backend and should address the error</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fitExtractVarPartModel.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">...</span>, BPPARAM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html">SnowParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/fitVarPartModel.html">fitVarPartModel</a></span><span class="op">(</span><span class="va">...</span>, BPPARAM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html">SnowParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/dream.html">dream</a></span><span class="op">(</span><span class="va">...</span>, BPPARAM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html">SnowParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/voomWithDreamWeights.html">voomWithDreamWeights</a></span><span class="op">(</span><span class="va">...</span>,BPPARAM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html">SnowParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</li>
</ul>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gabriel Hoffman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
